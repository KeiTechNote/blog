---
title: AWS API - IAM 
date: 2023-10-20 05:30 +09:00
published: true
categories: [Cloud]
tags: [Dev, Cloud, AWS, Python, Visibility, Automation]
---

### 개요

AWS 는 AWS 서비스에 대해 API를 통해 접근할 수 있도록 AWS API 라이브러리를 제공하고 있습니다. 
그 중 파이썬 기반의 AWS API 라이브러리인 Boto3 를 활용해 AWS 서비스별 정보를 수집하는 방법을 소개합니다. 

> 일련의 과정에서 AWS 서비스를 사용함에 따라 비용 청구에 대해 부담스러울 수 있습니다. 하지만, AWS 신규 계정을 생성하는 경우 일정 기간동안 AWS 서비스를 무료로 사용해 볼 수 있으며, 그럼에도 과금될 수 있으므로, 최소 사양으로 테스트하며 사용한 서비스의 리소스는 사용 후 삭제합니다. 
{: .prompt-info}

### AWS API 를 위한 Boto3 설치하기 

파이썬 라이브러리인 Boto3를 설치합니다. 

- 명령어 : pip install boto3

```shell
pip install boto3
```

> 파이썬 개발환경은 conda env 또는 venv 를 통해 개발 프로젝트별로 분리해 사용하는 것을 권장합니다. 
{: .prompt-info}


### AWS IAM 에 관하여 

AWS 에서 IAM 을 이해하면 50%는 학습이 끝났다고 이야기할 만큼 IAM 은 Cloud를 사용하는데 있어 매우 중요한 서비스입니다. 
주로 유저(사용자)를 관리하고 접근 레벨 및 권한 관리 기능을 제공합니다. 

"사용자를 관리"한다는 부분에서 용어가 갖는 오해의 소지가 있어 설명하고 넘어가겠습니다. 

처음 AWS 계정을 생성해 로그인하면 로그인한 계정을 AWS `Root 계정` 이라고 합니다. 이름에서처럼 Root 계정은 모든 권한을 갖고 있는 마스터 계정이며 모든 AWS 서비스를 사용할 수 있습니다. 
그 중 Root 계정은 IAM 을 통해 `유저`를 생성할 수 있습니다. 유저를 생성하면 AWS 는 유저에 대한 `접근키` 와 `비밀키` 를 생성하며 Cli 또는 API 환경에서 AWS 서비스에 접근할 수 있도록 도와줍니다. 하지만 Root 계정은 아직 유저에 대해 역할 또는 정책을 부여하지 않았으므로 할 수 있는 것은 아무것도 없습니다. 

이때, Root 계정은 그룹, 역할등을 통해 유저에게 정책을 부여합니다. 정책이란 권한으로 생각하면 됩니다. 유저가 할 수 있는 범위에 해당합니다. 

예를 들면, 사용중인 윈도우는 AWS Root 계정과 같은 관리자(Admin) 이 있고, 현재 로그인해 사용중인 유저(User)가 있습니다. 유저는 원하는 프로그램을 인터넷을 통해 다운받아 설치합니다. 이때, 윈도우에서는 프로그램 설치에 동의하는지, 설치하는 프로그램이 인터넷을 사용하려는데 동의하는지 알림창이 뜹니다. 알림창은 관리자가 승인하도록 되어 있으나 로그인한 유저는 관리자 그룹에 포함되어 있어 승인할 수 있으며 프로그램 설치를 완료할 수 있습니다. 

위의 예에서 윈도우에서 관리자(Admin)과 유저(User)는 각각 AWS Root 계정과 AWS 유저(User)와 같습니다. 관리자는 유저에게 인터넷에 접속할 수 있는 권한, 프로그램 다운로드 권한, 프로그램을 실행할 권한을 유저 역할에 부여했고 유저는 해당 역할을 수행할 수 있습니다. 
단, 유저는 설치나 인터넷 사용 허용 등에 관한 권한은 없으므로 알림창으로 관리자에게 확인 요청하게 됩니다. 
프로그램을 설치하는 동안 나타난 알림창에 대해 유저는 관리자 그룹에 소속되어 있고, 관리자 그룹에는 알림창에서 요구하는 내용을 승인할 수 있는 권한을 부여되어 있으므로, 유저는 관리자 그룹의 권한을 상속받아 승인할 수 있게 됩니다. 

윈도우에서 프로그램을 설치하는 일련의 과정에서 유저의 역할과 권한은 AWS 와 동일하게 작용합니다. 

위의 예를 설명하는 과정에서 IAM 의 구성요소 4가지가 모두 언급되었습니다. 

- 그룹 (Group)
- 유저 (User)
- 역할 (Role)
- 정책 (Policy)

각 구성요소는 다음과 같은 관계를 갖습니다. 

![AWS_API_IAM_1](/assets/images/aws_api_iam_1.jpeg)

_AWS IAM 구성요소 간 관계_

따라서, AWS API를 통해 IAM 의 구성요소 정보를 수집할 수 있습니다. 

### AWS IAM 준비 - 계정, 그룹 생성 

AWS IAM 정보를 수집하기 위해, 유저, 그룹을 생성하고 유저에게 IAM 리소스에 대한 접근 권한을 부여하겠습니다. 
우선 IAM 에서 유저와 그룹을 생성합니다. 본 Post 예제에서는 각각 `aws_radar` 과 `aws_viewer` 로 지정하겠습니다 .

- AWS 서비스 : IAM > 사용자 > 사용자 생성
- 계정명 : aws_radar
- 그룹 : aws_viewer

![aws_iam_create_user_1](/assets/images/aws_iam_create_user_1.png)

_IAM 사용자 생성 화면 (1) - 사용자 생성_

![aws_iam_create_user_2](/assets/images/aws_iam_create_user_2.png)

_IAM 사용자 생성 화면 (2)_

![aws_iam_create_user_3](/assets/images/aws_iam_create_user_3.png)

_IAM 사용자 생성 화면 (3) - 그룹 생성_

![aws_iam_create_user_4](/assets/images/aws_iam_create_user_4.png)

_IAM 사용자 생성 화면 (4) - 사용자를 그룹에 추가_

![aws_iam_create_user_5](/assets/images/aws_iam_create_user_5.png)

_IAM 사용자 생성 화면 (5) - 완료_

> 두번째 화면 (_IAM 사용자 생성 화면 (2)_) 또는 네번째 화면 (_IAM 사용자 생성 화면 (4) - 사용자를 그룹에 추가_) 에서 그룹에 권한을 부여할 수 있습니다. 권한 부여는 이후 API를 통해 접근하는 부분에서 설명하겠습니다. 
{: .prompt-info}


### AWS API 접근을 위한 Credential, Config 설정

신규 생성한 `유저`가 API를 통해 AWS 서비스에 접근할 수 있도록 Credential 과 Config 를 설정합니다. 

Config는 생성한 서비스가 위치할 리전(`Region`)을 지정하고, Credential은 API로 AWS 서비스에 접근할 때 사용할 접근키와 비밀키를 지정합니다. .aws 폴더와 credential, config 파일을 만듭니다. 

- 위치 : (윈도우) C:\Users\<사용자 계정명>\.aws 
- 파일명 : credential, config

![aws_iam_config_credential](/assets/images/aws_iam_config_credential.png)

_AWS 폴더 속 Credential, Config 파일_

Config 파일을 설정합니다. 본 Post 에서는 서울리전 (`ap-northeast-2`) 을 사용합니다. 

```
[default]
region=ap-northeast-2
```

Credential 파일을 설정합니다. Credential 파일을 설정하기 위해 접근키와 비밀키가 필요하며 AWS IAM 의 aws_radar 계정에서 발급할 수 있습니다. 

- 위치 : IAM > 사용자 > aws_radar 선택

![aws_iam_access_key_1](/assets/images/aws_iam_access_key_1.png)

_계정정보_

계정정보 화면에서 `액세스 키 만들기` 를 선택합니다. 액세스 키를 지원하는 다양한 환경이 있습니다. 
본 Post 에서는 로컬 PC 에서 API 로 AWS 서비스에 접근해야 하므로 `로컬 코드` 를 선택합니다. 

![aws_iam_access_key_2](/assets/images/aws_iam_access_key_2.png)

_액세스 키 만들기_







```
[default]
aws_access_key_id= < 접근키 >
aws_secret_access_key= < 비밀키 >
```






`유저`를 생성하면 AWS 는 접근키와 비밀키를 생성한다고 언급한 바 있습니다. 이렇게 ㅅ



### AWS API 테스트 





### AWS IAM 정책

AWS IAM을 API 접근해 수집하기 위해선 접근하는 유저에게 IAM 리소스에 접근할 수 있는 권한을 부여해야 합니다. 



### AWS API 정보 수집




---
### 정리
* 



---
### 참고
* 